define("paygw_paynocchio/wallet_topup",["exports","./repository"],(function(_exports,_repository){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0;
/**
   * Paynocchio repository module to encapsulate all of the AJAX requests that can be sent for bank.
   *
   * @module     paygw_paynocchio/repository
   * @copyright  2024 Paynocchio <ceo@paynocchio.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
const debounce=(callback,time)=>function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];let previousCall=this.lastCall;this.lastCall=Date.now(),previousCall&&this.lastCall-previousCall<=time&&clearTimeout(this.lastCallTimer),this.lastCallTimer=setTimeout((()=>callback(...args)),time)};_exports.init=(pay,minimum_topup_amount,card_balance_limit,balance,cost,topupamount)=>{const paynocchio_wallet_topup_button=document.getElementById("paynocchio_topup_button");paynocchio_wallet_topup_button&&paynocchio_wallet_topup_button.addEventListener("click",(()=>{(0,_repository.showModalWithTopup)(minimum_topup_amount,card_balance_limit,cost,topupamount).then((modal=>{modal.setTitle("Topup your Wallet");const button=modal.body.find("#topup_button"),input=modal.body.find("#top_up_amount"),message=modal.body.find("#topup_message"),commission_message=modal.body.find("#commission_message");(0,_repository.calculateReward)(minimum_topup_amount,"payment_operation_add_money").then((rewards=>{rewards.bonuses_to_get>0?(message.text(`You will get ${rewards.bonuses_to_get} bonuses.`),commission_message.text(`You will receive $${rewards.sum_without_commission}. \n                                        Commission is $${rewards.commission}.`)):(message.text(""),message.addClass("loading"),commission_message.text(""),commission_message.addClass("loading")),message.removeClass("loading"),commission_message.removeClass("loading")})),input.on("keyup change",(evt=>{const inputValue=parseFloat(evt.target.value);inputValue+balance>card_balance_limit?(message.text(`When replenishing the amount ${inputValue},\n                            the balance limit will exceed the set value ${card_balance_limit}.`),commission_message.text(""),button.addClass("disabled")):inputValue>=minimum_topup_amount?(message.addClass("loading"),commission_message.addClass("loading"),debounce((()=>{(0,_repository.calculateReward)(inputValue,"payment_operation_add_money").then((rewards=>{rewards.bonuses_to_get>0?(message.text(`You will get ${rewards.bonuses_to_get} bonuses.`),commission_message.text(`You will receive $${rewards.sum_without_commission}. \n                                                Commission: $${rewards.commission}.`)):(message.text(""),message.addClass("loading"),commission_message.text(""),commission_message.addClass("loading")),message.removeClass("loading"),commission_message.removeClass("loading")}))}),300),button.removeClass("disabled")):(message.text("Please enter amount more than minimum replenishment amount."),commission_message.text(""),button.addClass("disabled"))})),button.click((()=>{if(input.val()){button.addClass("disabled"),modal.body.find(".paynocchio-spinner").toggleClass("active"),modal.body.find("#topup_message").text("Working..."),modal.body.find("#commission_message").text("");let redirectLink=window.location.href,regex=new RegExp("[?&](success=)[^&]+");redirectLink=redirectLink.replace(regex,""),-1!=redirectLink.indexOf("?")?redirectLink+="&success=1":redirectLink+="?success=1",(0,_repository.handleTopUpClick)(input.val(),redirectLink).then((data=>{!data.is_error&&data.url?(modal.body.find("#topup_message").text("OK... Sending to Stripe..."),modal.body.find("#commission_message").text(""),window.location.replace(data.url)):(modal.body.find(".paynocchio-spinner").toggleClass("active"),modal.body.find("#commission_message").text(""),modal.body.find("#topup_message").text(data.message),button.toggleClass("disabled"))}))}}))}))}))}}));

//# sourceMappingURL=wallet_topup.min.js.map