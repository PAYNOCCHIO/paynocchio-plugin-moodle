define("paygw_paynocchio/paynocchio_pay",["exports","./repository","core/notification","core/templates"],(function(_exports,_repository,_notification,_templates){var obj;
/**
   * Paynocchio repository module to encapsulate all of the AJAX requests that can be sent for bank.
   *
   * @module     paygw_paynocchio/repository
   * @copyright  2024 Paynocchio <ceo@paynocchio.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */let debounceTimer;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_templates=(obj=_templates)&&obj.__esModule?obj:{default:obj};const debounce=(callback,time)=>{window.clearTimeout(debounceTimer),debounceTimer=window.setTimeout(callback,time)},checkPayability=function(bonuses,fullAmount){let balance=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"0",element=arguments.length>3?arguments[3]:void 0,bonuses_conversion_rate=arguments.length>4?arguments[4]:void 0;parseFloat(bonuses)*parseFloat(bonuses_conversion_rate)+parseFloat(balance)<parseFloat(fullAmount)?(element.classList.add("disabled"),document.getElementById("topup_message").innerText="Please top up or use your Bonuses.",document.getElementById("topup_message").classList.remove("paynocchio-hidden")):(element.classList.remove("disabled"),document.getElementById("topup_message").innerText="",document.getElementById("topup_message").classList.add("paynocchio-hidden"),document.getElementById("paynocchio_gaining_bonuses").classList.remove("paynocchio-hidden"))},changePayButtonValues=(fullAmount,bonuses,bonuses_conversion_rate)=>{const current_amount=document.getElementById("current_amount"),old_amount=document.getElementById("old_amount"),discount=document.getElementById("discount"),money_equivalent=document.getElementById("money_equivalent");let old_amount_value=fullAmount;bonuses>0?(1!==bonuses_conversion_rate&&(money_equivalent.innerHTML=`<span>$${bonuses*bonuses_conversion_rate}</span>`),current_amount.innerText=(old_amount_value-bonuses*bonuses_conversion_rate).toFixed(2),old_amount.innerText="$"+old_amount_value.toFixed(2),discount.innerText="â€”"+(bonuses*bonuses_conversion_rate*100/old_amount_value).toFixed(2)+"%",old_amount.classList.remove("paynocchio-hidden"),discount.classList.remove("paynocchio-hidden")):(money_equivalent.innerHTML="",current_amount.innerText=old_amount_value,old_amount.classList.add("paynocchio-hidden"),discount.classList.add("paynocchio-hidden"))},changeBonusesValue=(fullAmount,bonuses)=>{const element=document.getElementById("bonuses_to_get"),input=fullAmount-bonuses;element.classList.add("loading"),(0,_repository.calculateReward)(input,"payment_operation_for_services").then((rules=>{let bonuses_to_get_value=rules.bonuses_to_get;const paynocchio_gaining_bonuses=document.getElementById("paynocchio_gaining_bonuses");bonuses_to_get_value>0?(paynocchio_gaining_bonuses.classList.remove("paynocchio-hidden"),element.innerText=bonuses_to_get_value):paynocchio_gaining_bonuses.classList.add("paynocchio-hidden"),element.classList.remove("loading")}))};_exports.init=(component,paymentArea,description,itemid,fullAmount,balance,bonuses_conversion_rate)=>{const paynocchio_pay_button=document.getElementById("paynocchio_pay_button");if(paynocchio_pay_button){const range=document.getElementById("bonuses-range"),input=document.getElementById("bonuses-value");let bonuses=0;input&&(bonuses=parseFloat(input.value)),range&&input?(checkPayability(bonuses,fullAmount,balance,paynocchio_pay_button,bonuses_conversion_rate),input.addEventListener("change",(()=>{range.value=bonuses})),range.addEventListener("change",(()=>{bonuses=range.value,input.value=range.value,checkPayability(bonuses,fullAmount,balance,paynocchio_pay_button,bonuses_conversion_rate),changePayButtonValues(fullAmount,bonuses,bonuses_conversion_rate),debounce((()=>changeBonusesValue(fullAmount,bonuses*bonuses_conversion_rate)),300)})),range.addEventListener("input",(()=>{bonuses=range.value,input.value=range.value,checkPayability(bonuses,fullAmount,balance,paynocchio_pay_button,bonuses_conversion_rate),debounce((()=>changeBonusesValue(fullAmount,bonuses*bonuses_conversion_rate)),300),changePayButtonValues(fullAmount,bonuses,bonuses_conversion_rate)}))):checkPayability(0,fullAmount,balance,paynocchio_pay_button,bonuses_conversion_rate),paynocchio_pay_button.addEventListener("click",(()=>{const spinner=document.querySelector(".paynocchio-spinner"),topup_message=document.getElementById("topup_message");bonuses+balance<fullAmount?topup_message.innerText="Sorry, but no":(paynocchio_pay_button.classList.add("disabled"),spinner.classList.add("active"),(0,_repository.makePayment)(component,paymentArea,description,itemid,fullAmount,bonuses).then((data=>{data.success?(spinner.classList.remove("active"),topup_message.innerText="Success",window.location.reload(),_templates.default.renderForPromise("paygw_paynocchio/enrolled_already",[]).then((_ref=>{let{html:html,js:js}=_ref;_templates.default.replaceNodeContents(".paynocchio-profile-block",html,js)})).catch((error=>(0,_notification.exception)(error)))):(topup_message.innerText="There is an Error occurred. Please try again later.",paynocchio_pay_button.classList.remove("disabled"))})))}))}}}));

//# sourceMappingURL=paynocchio_pay.min.js.map