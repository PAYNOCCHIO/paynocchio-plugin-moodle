define("paygw_paynocchio/paynocchio_pay",["exports","./repository","core/notification","core/templates"],(function(_exports,_repository,_notification,_templates){var obj;
/**
   * Paynocchio repository module to encapsulate all of the AJAX requests that can be sent for bank.
   *
   * @module     paygw_paynocchio/repository
   * @copyright  2024 Paynocchio <ceo@paynocchio.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_templates=(obj=_templates)&&obj.__esModule?obj:{default:obj};const checkPayability=function(value,fullAmount){let balance=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"0",element=arguments.length>3?arguments[3]:void 0;parseFloat(value)+parseFloat(balance)<parseFloat(fullAmount)?(element.classList.add("disabled"),document.getElementById("topup_message").innerText="Please top up or use your Bonuses.",document.getElementById("topup_message").classList.remove("paynocchio-hidden")):(element.classList.remove("disabled"),document.getElementById("topup_message").innerText="",document.getElementById("topup_message").classList.add("paynocchio-hidden"),document.getElementById("paynocchio_gaining_bonuses").classList.remove("paynocchio-hidden"))},changePayButtonValues=(fullAmount,bonuses)=>{const current_amount=document.getElementById("current_amount"),old_amount=document.getElementById("old_amount"),discount=document.getElementById("discount");let old_amount_value=fullAmount;0!=bonuses?(current_amount.innerText=old_amount_value-bonuses,old_amount.innerText="$"+old_amount_value,discount.innerText="-"+100*bonuses/old_amount_value+"%",old_amount.classList.remove("paynocchio-hidden"),discount.classList.remove("paynocchio-hidden")):(current_amount.innerText=old_amount_value,old_amount.classList.add("paynocchio-hidden"),discount.classList.add("paynocchio-hidden"))},changeBonusesValue=(balance,bonuses)=>{document.getElementById("bonuses_to_get").innerText=(.1*(balance-bonuses)).toFixed(2).slice(0,-1)};_exports.init=(component,paymentArea,itemid,fullAmount,balance,bonuses_conversion_rate)=>{const paynocchio_pay_button=document.getElementById("paynocchio_pay_button");if(paynocchio_pay_button){const range=document.getElementById("bonuses-range"),input=document.getElementById("bonuses-value");let bonuses=0;input&&(bonuses=parseFloat(input.value)*parseFloat(bonuses_conversion_rate)),range&&input?(checkPayability(bonuses,fullAmount,balance,paynocchio_pay_button),input.addEventListener("change",(()=>{range.value=bonuses})),range.addEventListener("change",(()=>{bonuses=range.value,input.value=range.value,checkPayability(bonuses,fullAmount,balance,paynocchio_pay_button),changeBonusesValue(fullAmount,bonuses),changePayButtonValues(fullAmount,bonuses)})),range.addEventListener("input",(()=>{bonuses=range.value,input.value=range.value,checkPayability(bonuses,fullAmount,balance,paynocchio_pay_button),changeBonusesValue(fullAmount,bonuses),changePayButtonValues(fullAmount,bonuses)}))):checkPayability(0,fullAmount,balance,paynocchio_pay_button),paynocchio_pay_button.addEventListener("click",(()=>{const spinner=document.querySelector(".paynocchio-spinner"),topup_message=document.getElementById("topup_message");bonuses+balance<fullAmount?topup_message.innerText="Sorry, but no":(paynocchio_pay_button.classList.add("disabled"),spinner.classList.add("active"),(0,_repository.makePayment)(component,paymentArea,itemid,fullAmount,bonuses).then((data=>{data.success?(spinner.classList.remove("active"),topup_message.innerText="Success",window.location.reload(),_templates.default.renderForPromise("paygw_paynocchio/enrolled_already",[]).then((_ref=>{let{html:html,js:js}=_ref;_templates.default.replaceNodeContents(".paynocchio-profile-block",html,js)})).catch((error=>(0,_notification.exception)(error)))):(topup_message.innerText="There is an Error occurred. Please try again later.",paynocchio_pay_button.classList.remove("disabled"))})))}))}}}));

//# sourceMappingURL=paynocchio_pay.min.js.map